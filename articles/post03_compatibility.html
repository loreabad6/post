<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Compatibility with other packages • post</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Open_Sans-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="post03_compatibility_files/libs/quarto-html/popper.min.js"></script><script src="post03_compatibility_files/libs/quarto-html/tippy.umd.min.js"></script><link href="post03_compatibility_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="post03_compatibility_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Compatibility with other packages">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">post</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/post01_post.html">Vector data cube structures</a></li>
    <li><a class="dropdown-item" href="../articles/post02_geomsum.html">Summarising geometries</a></li>
    <li><a class="dropdown-item" href="../articles/post03_compatibility.html">Compatibility with other packages</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/loreabad6/post" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Compatibility with other packages</h1>




      <small class="dont-index">Source: <a href="https://github.com/loreabad6/post/blob/HEAD/vignettes/post03_compatibility.qmd" class="external-link"><code>vignettes/post03_compatibility.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://loreabad6.github.io/post/">post</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/huizezhang-sherry/cubble" class="external-link">cubble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/" class="external-link">stars</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tsibble.tidyverts.org" class="external-link">tsibble</a></span><span class="op">)</span></span></code></pre></div>
</div>
<p>The classes provided in <code>post</code> are designed so that the majority of functions and methods available for <code>cubble</code> or <code>stars</code> objects are still applicable to <code>post_*</code> objects, while keeping the post class and attributes in the process.</p>
<p>The main compatibility functions are presented in this vignette.</p>
<section class="level2"><h2 id="cubble-compatibility">
<code>cubble</code> compatibility<a class="anchor" aria-label="anchor" href="#cubble-compatibility"></a>
</h2>
<p>Objects of class <code>post_table</code> are compatible with most of <code>cubble</code>s methods as presented below.</p>
<section class="level3"><h3 id="spatial-and-temporal-faces">Spatial and temporal faces<a class="anchor" aria-label="anchor" href="#spatial-and-temporal-faces"></a>
</h3>
<p>The main functionalities of <a href="https://github.com/huizezhang-sherry/cubble" class="external-link">cubble</a> are the ability to do analyses on the spatial or on the temporal faces of the vector data cube. For this, the functions <code><a href="https://huizezhang-sherry.github.io/cubble/reference/face.html" class="external-link">cubble::face_spatial()</a></code> and <code><a href="https://huizezhang-sherry.github.io/cubble/reference/face.html" class="external-link">cubble::face_temporal()</a></code> are provided. The spatial face is the default state of a cubble object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tab</span> <span class="op">=</span> <span class="fu"><a href="../reference/as_post_table.html">as_post_table</a></span><span class="op">(</span><span class="va">polygons</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://huizezhang-sherry.github.io/cubble/reference/face.html" class="external-link">face_spatial</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span></span>
<span><span class="co">#&gt; ℹ The cubble is already in the nested form</span></span>
<span><span class="co">#&gt; # cubble:   key: gid [5], index: datetime, nested form, [sf]</span></span>
<span><span class="co">#&gt; # spatial:  [-0.01, 0.2, 0.76, 0.9], WGS 84</span></span>
<span><span class="co">#&gt; # temporal: datetime [date], geometry [POLYGON [°]]</span></span>
<span><span class="co">#&gt;   gid       long   lat                 geom_sum ts          </span></span>
<span><span class="co">#&gt; * &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;              &lt;POINT [°]&gt; &lt;list&gt;      </span></span>
<span><span class="co">#&gt; 1 a      0.653   0.902     (0.6526028 0.901785) &lt;sf [5 × 2]&gt;</span></span>
<span><span class="co">#&gt; 2 b     -0.00954 0.855 (-0.009536052 0.8549277) &lt;sf [5 × 2]&gt;</span></span>
<span><span class="co">#&gt; 3 c      0.393   0.557    (0.3932031 0.5571231) &lt;sf [5 × 2]&gt;</span></span>
<span><span class="co">#&gt; 4 d      0.763   0.365    (0.7627982 0.3647986) &lt;sf [5 × 2]&gt;</span></span>
<span><span class="co">#&gt; 5 e      0.472   0.195    (0.4718622 0.1952443) &lt;sf [5 × 2]&gt;</span></span>
<span><span class="fu"><a href="https://huizezhang-sherry.github.io/cubble/reference/face.html" class="external-link">face_temporal</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span></span>
<span><span class="co">#&gt; # cubble:   key: gid [5], index: datetime, long form</span></span>
<span><span class="co">#&gt; # temporal: 2020-10-01 -- 2020-10-05 [1D], no gaps</span></span>
<span><span class="co">#&gt; # spatial:  long [dbl], lat [dbl], geom_sum [POINT [°]]</span></span>
<span><span class="co">#&gt;    gid   datetime                                                       geometry</span></span>
<span><span class="co">#&gt;  * &lt;chr&gt; &lt;date&gt;                                                    &lt;POLYGON [°]&gt;</span></span>
<span><span class="co">#&gt;  1 a     2020-10-01 ((0.5474949 0.8088912, 0.4874872 0.8838477, 0.5520055 1.032…</span></span>
<span><span class="co">#&gt;  2 a     2020-10-02 ((0.4961102 0.8728385, 0.4361026 0.947795, 0.5006209 1.0966…</span></span>
<span><span class="co">#&gt;  3 a     2020-10-03 ((0.5578801 0.8616378, 0.5623908 1.085448, 0.8520717 0.8981…</span></span>
<span><span class="co">#&gt;  4 a     2020-10-04 ((0.5652241 0.872057, 0.5685463 1.036898, 0.7819022 0.89897…</span></span>
<span><span class="co">#&gt;  5 a     2020-10-05 ((0.6063791 0.8304178, 0.5463715 0.9053744, 0.6108898 1.054…</span></span>
<span><span class="co">#&gt;  6 b     2020-10-01 ((0.2791708 0.8337388, -0.2847997 0.6540191, -0.2825181 0.6…</span></span>
<span><span class="co">#&gt;  7 b     2020-10-02 ((0.3298312 0.7612067, -0.2341393 0.5814869, -0.2318577 0.5…</span></span>
<span><span class="co">#&gt;  8 b     2020-10-03 ((0.3796448 0.767853, -0.1843257 0.5881332, 0.09777458 1.05…</span></span>
<span><span class="co">#&gt;  9 b     2020-10-04 ((0.3642467 0.779727, -0.1182199 0.6259799, 0.1231118 1.026…</span></span>
<span><span class="co">#&gt; 10 b     2020-10-05 ((0.2665368 0.8649996, -0.2974337 0.6852798, -0.2951521 0.6…</span></span>
<span><span class="co">#&gt; # ℹ 15 more rows</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="attribute-extraction">Attribute extraction<a class="anchor" aria-label="anchor" href="#attribute-extraction"></a>
</h3>
<p>Extracting <code>cubble</code> attributes is also possible. cubble follows the attributes from <a href="https://tsibble.tidyverts.org" class="external-link">tsibble</a> objects, where the <code>key</code> is equivalent to the group identifier and the <code>index</code> is equivalent to the temporal column in <code>post_table</code> objects.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cubble</span><span class="fu">::</span><span class="fu"><a href="https://huizezhang-sherry.github.io/cubble/reference/attr.html" class="external-link">coords</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "long" "lat"</span></span>
<span><span class="fu">cubble</span><span class="fu">::</span><span class="fu">index</span><span class="op">(</span><span class="va">tab</span><span class="op">)</span></span>
<span><span class="co">#&gt; datetime</span></span>
<span><span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/key.html" class="external-link">key</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; gid</span></span>
<span><span class="fu">cubble</span><span class="fu">::</span><span class="fu"><a href="https://huizezhang-sherry.github.io/cubble/reference/attr.html" class="external-link">spatial</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 5 features and 3 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -0.009536052 ymin: 0.1952443 xmax: 0.7627982 ymax: 0.901785</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; # A tibble: 5 × 4</span></span>
<span><span class="co">#&gt;   gid       long   lat                 geom_sum</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;              &lt;POINT [°]&gt;</span></span>
<span><span class="co">#&gt; 1 a      0.653   0.902     (0.6526028 0.901785)</span></span>
<span><span class="co">#&gt; 2 b     -0.00954 0.855 (-0.009536052 0.8549277)</span></span>
<span><span class="co">#&gt; 3 c      0.393   0.557    (0.3932031 0.5571231)</span></span>
<span><span class="co">#&gt; 4 d      0.763   0.365    (0.7627982 0.3647986)</span></span>
<span><span class="co">#&gt; 5 e      0.472   0.195    (0.4718622 0.1952443)</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="gap-filling-with-tsibble">Gap filling with tsibble<a class="anchor" aria-label="anchor" href="#gap-filling-with-tsibble"></a>
</h3>
<p><code>cubble</code> also supports compatibility with some <code>tsibble</code> functions, namely gap filling, <code><a href="https://tsibble.tidyverts.org/reference/fill_gaps.html" class="external-link">tsibble::fill_gaps()</a></code>. If we sample the original polygon to create random gaps, we can use this function to fill them with NA values and empty geometries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">324</span><span class="op">)</span></span>
<span><span class="va">tab_gaps</span> <span class="op">=</span> <span class="va">polygons</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">polygons</span><span class="op">)</span>, <span class="fl">13</span><span class="op">)</span>, <span class="op">]</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/as_post_table.html">as_post_table</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="va">tab_gaps</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://huizezhang-sherry.github.io/cubble/reference/face.html" class="external-link">face_temporal</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # cubble:   key: gid [5], index: datetime, long form</span></span>
<span><span class="co">#&gt; # temporal: 2020-10-01 -- 2020-10-05 [1D], has gaps!</span></span>
<span><span class="co">#&gt; # spatial:  long [dbl], lat [dbl], geom_sum [POINT [°]]</span></span>
<span><span class="co">#&gt;    gid   datetime                                                       geometry</span></span>
<span><span class="co">#&gt;  * &lt;chr&gt; &lt;date&gt;                                                    &lt;POLYGON [°]&gt;</span></span>
<span><span class="co">#&gt;  1 a     2020-10-01 ((0.5474949 0.8088912, 0.4874872 0.8838477, 0.5520055 1.032…</span></span>
<span><span class="co">#&gt;  2 a     2020-10-05 ((0.6063791 0.8304178, 0.5463715 0.9053744, 0.6108898 1.054…</span></span>
<span><span class="co">#&gt;  3 b     2020-10-01 ((0.2791708 0.8337388, -0.2847997 0.6540191, -0.2825181 0.6…</span></span>
<span><span class="co">#&gt;  4 b     2020-10-02 ((0.3298312 0.7612067, -0.2341393 0.5814869, -0.2318577 0.5…</span></span>
<span><span class="co">#&gt;  5 c     2020-10-03 ((0.2897647 0.6168588, 0.3415208 0.710566, 0.5357965 0.4922…</span></span>
<span><span class="co">#&gt;  6 c     2020-10-04 ((0.2930046 0.6546896, 0.3210764 0.7055149, 0.4264484 0.587…</span></span>
<span><span class="co">#&gt;  7 d     2020-10-01 ((0.7650701 0.4744459, 0.8787185 0.375316, 0.8266421 0.2890…</span></span>
<span><span class="co">#&gt;  8 d     2020-10-04 ((0.6687306 0.4190113, 0.7593946 0.3399296, 0.6862765 0.233…</span></span>
<span><span class="co">#&gt;  9 d     2020-10-05 ((0.8594322 0.4155757, 0.9730806 0.3164458, 0.9210042 0.230…</span></span>
<span><span class="co">#&gt; 10 e     2020-10-01 ((0.3825692 0.3537803, 0.5519791 0.3669884, 0.6063218 0.096…</span></span>
<span><span class="co">#&gt; 11 e     2020-10-02 ((0.3101455 0.3168974, 0.4795555 0.3301055, 0.5338981 0.059…</span></span>
<span><span class="co">#&gt; 12 e     2020-10-03 ((0.2813385 0.2544898, 0.4507484 0.2676979, 0.505091 -0.002…</span></span>
<span><span class="co">#&gt; 13 e     2020-10-04 ((0.3130673 0.2176433, 0.4498424 0.228307, 0.4939709 0.0085…</span></span>
<span><span class="va">tab_gaps</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://huizezhang-sherry.github.io/cubble/reference/face.html" class="external-link">face_temporal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tsibble.tidyverts.org/reference/fill_gaps.html" class="external-link">fill_gaps</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # cubble:   key: gid [5], index: datetime, long form</span></span>
<span><span class="co">#&gt; # temporal: 2020-10-01 -- 2020-10-05 [1D], no gaps</span></span>
<span><span class="co">#&gt; # spatial:  long [dbl], lat [dbl], geom_sum [POINT [°]]</span></span>
<span><span class="co">#&gt;    gid   datetime                                                       geometry</span></span>
<span><span class="co">#&gt;  * &lt;chr&gt; &lt;date&gt;                                                    &lt;POLYGON [°]&gt;</span></span>
<span><span class="co">#&gt;  1 a     2020-10-01 ((0.5474949 0.8088912, 0.4874872 0.8838477, 0.5520055 1.032…</span></span>
<span><span class="co">#&gt;  2 a     2020-10-02                                                        EMPTY</span></span>
<span><span class="co">#&gt;  3 a     2020-10-03                                                        EMPTY</span></span>
<span><span class="co">#&gt;  4 a     2020-10-04                                                        EMPTY</span></span>
<span><span class="co">#&gt;  5 a     2020-10-05 ((0.6063791 0.8304178, 0.5463715 0.9053744, 0.6108898 1.054…</span></span>
<span><span class="co">#&gt;  6 b     2020-10-01 ((0.2791708 0.8337388, -0.2847997 0.6540191, -0.2825181 0.6…</span></span>
<span><span class="co">#&gt;  7 b     2020-10-02 ((0.3298312 0.7612067, -0.2341393 0.5814869, -0.2318577 0.5…</span></span>
<span><span class="co">#&gt;  8 c     2020-10-03 ((0.2897647 0.6168588, 0.3415208 0.710566, 0.5357965 0.4922…</span></span>
<span><span class="co">#&gt;  9 c     2020-10-04 ((0.2930046 0.6546896, 0.3210764 0.7055149, 0.4264484 0.587…</span></span>
<span><span class="co">#&gt; 10 d     2020-10-01 ((0.7650701 0.4744459, 0.8787185 0.375316, 0.8266421 0.2890…</span></span>
<span><span class="co">#&gt; 11 d     2020-10-02                                                        EMPTY</span></span>
<span><span class="co">#&gt; 12 d     2020-10-03                                                        EMPTY</span></span>
<span><span class="co">#&gt; 13 d     2020-10-04 ((0.6687306 0.4190113, 0.7593946 0.3399296, 0.6862765 0.233…</span></span>
<span><span class="co">#&gt; 14 d     2020-10-05 ((0.8594322 0.4155757, 0.9730806 0.3164458, 0.9210042 0.230…</span></span>
<span><span class="co">#&gt; 15 e     2020-10-01 ((0.3825692 0.3537803, 0.5519791 0.3669884, 0.6063218 0.096…</span></span>
<span><span class="co">#&gt; 16 e     2020-10-02 ((0.3101455 0.3168974, 0.4795555 0.3301055, 0.5338981 0.059…</span></span>
<span><span class="co">#&gt; 17 e     2020-10-03 ((0.2813385 0.2544898, 0.4507484 0.2676979, 0.505091 -0.002…</span></span>
<span><span class="co">#&gt; 18 e     2020-10-04 ((0.3130673 0.2176433, 0.4498424 0.228307, 0.4939709 0.0085…</span></span></code></pre></div>
</div>
<p>The function <code><a href="https://tsibble.tidyverts.org/reference/scan_gaps.html" class="external-link">tsibble::scan_gaps()</a></code> on the other hand does not return a <code>post_table</code> object since all the geometries would be <code>EMPTY</code> and the inherit structure of a post object is lost.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tab_gaps</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://huizezhang-sherry.github.io/cubble/reference/face.html" class="external-link">face_temporal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tsibble.tidyverts.org/reference/scan_gaps.html" class="external-link">scan_gaps</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # cubble:   key: gid [5], index: datetime, long form, [tsibble]</span></span>
<span><span class="co">#&gt; # temporal: 2020-10-02 -- 2020-10-04 [1D], no gaps</span></span>
<span><span class="co">#&gt; # spatial:  long [dbl], lat [dbl], geom_sum [POINT [°]]</span></span>
<span><span class="co">#&gt;   gid   datetime  </span></span>
<span><span class="co">#&gt;   &lt;chr&gt; &lt;date&gt;    </span></span>
<span><span class="co">#&gt; 1 a     2020-10-02</span></span>
<span><span class="co">#&gt; 2 a     2020-10-03</span></span>
<span><span class="co">#&gt; 3 a     2020-10-04</span></span>
<span><span class="co">#&gt; 4 d     2020-10-02</span></span>
<span><span class="co">#&gt; 5 d     2020-10-03</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="glyph-maps">Glyph maps<a class="anchor" aria-label="anchor" href="#glyph-maps"></a>
</h3>
<p>For visualisation, <code>cubble</code> provides the <code><a href="https://huizezhang-sherry.github.io/cubble/reference/glyph.html" class="external-link">cubble::geom_glyph()</a></code> function to be used with <a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a> plots. This geom is useful to have a quick glance at the temporal variation of specific variables while also being aware of the spatial distribution of the features.</p>
<p>To use this one with <code>post_table</code> objects we have to unfold the <code>long</code> and <code>lat</code> functions into the temporal face of the vector data cube.</p>
<p>Then, to pass it onto the ggplot function, the <code>post_table</code> class should be dropped to avoid conflicts. The utility function <code><a href="../reference/classes.html">remove_post_table()</a></code> is provided for this purpose.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tab_union</span> <span class="op">=</span> <span class="fu"><a href="../reference/as_post_table.html">as_post_table</a></span><span class="op">(</span><span class="va">polygons</span>, geometry_summary <span class="op">=</span> <span class="va">summarise_geometry_union</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: st_centroid assumes attributes are constant over geometries</span></span>
<span><span class="va">tab_unf</span> <span class="op">=</span> <span class="va">polygons</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/as_post_table.html">as_post_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://huizezhang-sherry.github.io/cubble/reference/face.html" class="external-link">face_temporal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://huizezhang-sherry.github.io/cubble/reference/unfold.html" class="external-link">unfold</a></span><span class="op">(</span><span class="va">long</span>, <span class="va">lat</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="../reference/classes.html">remove_post_table</a></span><span class="op">(</span><span class="va">tab_unf</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x_major <span class="op">=</span> <span class="va">long</span>, y_major <span class="op">=</span> <span class="va">lat</span>, x_minor <span class="op">=</span> <span class="va">datetime</span>, y_minor <span class="op">=</span> <span class="va">area</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tab_union</span>, fill <span class="op">=</span> <span class="st">"grey80"</span>, color <span class="op">=</span> <span class="cn">NA</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://huizezhang-sherry.github.io/cubble/reference/glyph.html" class="external-link">geom_glyph_box</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.18</span>, height <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://huizezhang-sherry.github.io/cubble/reference/glyph.html" class="external-link">geom_glyph</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">area</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.18</span>, height <span class="op">=</span> <span class="fl">0.1</span>, linewidth <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="post03_compatibility_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section><section class="level2"><h2 id="stars-compatibility">
<code>stars</code> compatibility<a class="anchor" aria-label="anchor" href="#stars-compatibility"></a>
</h2>
<p>Objects of class <code>post_array</code> inherit also the <code>stars</code> class, so most of the methods for stars objects are applicable to post objects as shown below.</p>
<section class="level3"><h3 id="subsetting">Subsetting<a class="anchor" aria-label="anchor" href="#subsetting"></a>
</h3>
<p><code>stars</code> and hence <code>post_array</code> objects are in esence arrays, therefore we can use the <code>[</code> operator for subsetting (see more on its usage <a href="https://r-spatial.github.io/stars/articles/stars1.html#subsetting" class="external-link">on the corresponding stars vignette</a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">arr</span> <span class="op">=</span> <span class="fu"><a href="../reference/as_post_array.html">as_post_array</a></span><span class="op">(</span><span class="va">polygons</span>, geometry_summary <span class="op">=</span> <span class="va">summarise_geometry_union</span><span class="op">)</span></span>
<span><span class="co"># subset first two features</span></span>
<span><span class="va">arr</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,<span class="op">]</span></span>
<span><span class="co">#&gt; stars object with 2 dimensions and 1 attribute</span></span>
<span><span class="co">#&gt; attribute(s):</span></span>
<span><span class="co">#&gt;          geometry  </span></span>
<span><span class="co">#&gt;  POLYGON      :10  </span></span>
<span><span class="co">#&gt;  epsg:4326    : 0  </span></span>
<span><span class="co">#&gt;  +proj=long...: 0  </span></span>
<span><span class="co">#&gt; dimension(s):</span></span>
<span><span class="co">#&gt;          from to     offset  delta refsys point</span></span>
<span><span class="co">#&gt; geom_sum    1  2         NA     NA WGS 84 FALSE</span></span>
<span><span class="co">#&gt; datetime    1  5 2020-10-01 1 days   Date FALSE</span></span>
<span><span class="co">#&gt;                                                                  values</span></span>
<span><span class="co">#&gt; geom_sum POLYGON ((0.4971 0.8718, 0...., POLYGON ((-0.1774 0.5996, -...</span></span>
<span><span class="co">#&gt; datetime                                                           NULL</span></span>
<span><span class="co"># subset last three timestamps</span></span>
<span><span class="va">arr</span><span class="op">[</span>,,<span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt; stars object with 2 dimensions and 1 attribute</span></span>
<span><span class="co">#&gt; attribute(s):</span></span>
<span><span class="co">#&gt;          geometry  </span></span>
<span><span class="co">#&gt;  POLYGON      :15  </span></span>
<span><span class="co">#&gt;  epsg:4326    : 0  </span></span>
<span><span class="co">#&gt;  +proj=long...: 0  </span></span>
<span><span class="co">#&gt; dimension(s):</span></span>
<span><span class="co">#&gt;          from to     offset  delta refsys point</span></span>
<span><span class="co">#&gt; geom_sum    1  5         NA     NA WGS 84 FALSE</span></span>
<span><span class="co">#&gt; datetime    3  5 2020-10-01 1 days   Date FALSE</span></span>
<span><span class="co">#&gt;                                                                 values</span></span>
<span><span class="co">#&gt; geom_sum POLYGON ((0.4971355 0.871...,...,POLYGON ((0.2973931 0.255...</span></span>
<span><span class="co">#&gt; datetime                                                          NULL</span></span></code></pre></div>
</div>
<p>Note how the number of geometries in the attributes varies according to the subsetting operation.</p>
<p>When extracting the attributes themselves, the <code>[[</code> can be used. Note that the <code>geometry</code> attribute in the <code>arr</code> object we created is an <code>sfc</code> object but it has dimensions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">arr</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; Geometry set for 25 features  [dim: 5 x 5]</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -0.2974337 ymin: -0.00297557 xmax: 0.9730806 ymax: 1.153558</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; First 5 geometries:</span></span>
<span><span class="co">#&gt; POLYGON ((0.5474949 0.8088912, 0.4874872 0.8838...</span></span>
<span><span class="co">#&gt; POLYGON ((0.2791708 0.8337388, -0.2847997 0.654...</span></span>
<span><span class="co">#&gt; POLYGON ((0.2807462 0.6277986, 0.3325024 0.7215...</span></span>
<span><span class="co">#&gt; POLYGON ((0.7650701 0.4744459, 0.8787185 0.3753...</span></span>
<span><span class="co">#&gt; POLYGON ((0.3825692 0.3537803, 0.5519791 0.3669...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">arr</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "sfc_POLYGON" "sfc"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">arr</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; geom_sum datetime </span></span>
<span><span class="co">#&gt;        5        5</span></span></code></pre></div>
</div>
<p>We can also create new attributes, for example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">arr</span><span class="op">$</span><span class="va">area</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">arr</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">arr</span></span>
<span><span class="co">#&gt; stars object with 2 dimensions and 2 attributes</span></span>
<span><span class="co">#&gt; attribute(s):</span></span>
<span><span class="co">#&gt;          geometry       area           </span></span>
<span><span class="co">#&gt;  POLYGON      :25   Min.   :5.366e+07  </span></span>
<span><span class="co">#&gt;  epsg:4326    : 0   1st Qu.:3.928e+08  </span></span>
<span><span class="co">#&gt;  +proj=long...: 0   Median :4.060e+08  </span></span>
<span><span class="co">#&gt;                     Mean   :6.216e+08  </span></span>
<span><span class="co">#&gt;                     3rd Qu.:6.933e+08  </span></span>
<span><span class="co">#&gt;                     Max.   :1.537e+09  </span></span>
<span><span class="co">#&gt; dimension(s):</span></span>
<span><span class="co">#&gt;          from to     offset  delta refsys point</span></span>
<span><span class="co">#&gt; geom_sum    1  5         NA     NA WGS 84 FALSE</span></span>
<span><span class="co">#&gt; datetime    1  5 2020-10-01 1 days   Date FALSE</span></span>
<span><span class="co">#&gt;                                                                 values</span></span>
<span><span class="co">#&gt; geom_sum POLYGON ((0.4971355 0.871...,...,POLYGON ((0.2973931 0.255...</span></span>
<span><span class="co">#&gt; datetime                                                          NULL</span></span></code></pre></div>
</div>
<p>And the functionality to use <code>[</code> as a “crop” operator is also supported. However, in this case a spatial filtering rather than a cropping operation takes place.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">circles</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.55</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.75</span>,<span class="fl">0.4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span><span class="fl">10000</span><span class="op">)</span></span>
<span><span class="va">arr</span><span class="op">[</span><span class="va">circles</span><span class="op">]</span></span>
<span><span class="co">#&gt; stars object with 2 dimensions and 2 attributes</span></span>
<span><span class="co">#&gt; attribute(s):</span></span>
<span><span class="co">#&gt;          geometry       area           </span></span>
<span><span class="co">#&gt;  POLYGON      :10   Min.   : 53657361  </span></span>
<span><span class="co">#&gt;  epsg:4326    : 0   1st Qu.:266964303  </span></span>
<span><span class="co">#&gt;  +proj=long...: 0   Median :392817773  </span></span>
<span><span class="co">#&gt;                     Mean   :321257030  </span></span>
<span><span class="co">#&gt;                     3rd Qu.:394413594  </span></span>
<span><span class="co">#&gt;                     Max.   :394950797  </span></span>
<span><span class="co">#&gt; dimension(s):</span></span>
<span><span class="co">#&gt;          from to     offset  delta refsys point</span></span>
<span><span class="co">#&gt; geom_sum    3  4         NA     NA WGS 84 FALSE</span></span>
<span><span class="co">#&gt; datetime    1  5 2020-10-01 1 days   Date FALSE</span></span>
<span><span class="co">#&gt;                                                                  values</span></span>
<span><span class="co">#&gt; geom_sum POLYGON ((0.2866 0.6085, 0...., POLYGON ((0.5737 0.4614, 0....</span></span>
<span><span class="co">#&gt; datetime                                                           NULL</span></span></code></pre></div>
</div>
<p>Note that the spatial dimension <code>geom_sum</code> is the one that gets filtered and not the changing geometries <a class="footnote-ref" role="doc-noteref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;see section &lt;a href="#sec-spatfilt" class="quarto-xref"&gt;Section 3.4&lt;/a&gt; on how to perform a spatial filter of the changing geometries&lt;/p&gt;'><sup>1</sup></a>. Therefore, the filtered <code>post_array</code> also keeps geometries that do not intersect <code>circles</code> by themselves but their summary geometry does.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">arr</span><span class="op">$</span><span class="va">geometry</span>, col <span class="op">=</span> <span class="st">"grey80"</span>, border <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">circles</span>, col <span class="op">=</span> <span class="st">"deepskyblue3"</span>, border <span class="op">=</span> <span class="cn">NA</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">arr</span><span class="op">[</span><span class="va">circles</span><span class="op">]</span><span class="op">$</span><span class="va">geometry</span>, border <span class="op">=</span> <span class="st">"firebrick1"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="post03_compatibility_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section class="level3"><h3 id="apply-functions-to-array-dimensions">Apply functions to array dimensions<a class="anchor" aria-label="anchor" href="#apply-functions-to-array-dimensions"></a>
</h3>
<p><em>Needs input</em></p>
<!--
TODO: test st_apply, maybe examples with stampr
https://r-spatial.github.io/stars/reference/st_apply.html
-->
</section></section><section class="level2"><h2 id="sf-compatibility">
<code>sf</code> compatibility<a class="anchor" aria-label="anchor" href="#sf-compatibility"></a>
</h2>
<p>Both post classes, i.e. <code>post_array</code> and <code>post_table</code> support most sf methods since they inherit implicitly or explicitly the <code>sf</code> or <code>sfc</code> class.</p>
<p>Methods that are not supported for post objects include:</p>
<ul>
<li>Geometric operations on pairs of simple features (see <code><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">?sf::geos_binary_ops</a></code>) are not supported for post objects since they change the topology of the object in ways that can’t be reconstructed without further knowledge on how summary and changing polygons should be adapted.</li>
</ul>
<section class="level3"><h3 id="converting-to-sf">Converting to <code>sf</code>
<a class="anchor" aria-label="anchor" href="#converting-to-sf"></a>
</h3>
<p>When converting a <code>post_*</code> object to <code>sf</code> both the summary and changing geometries are preserved, and the changing geometry is set as the active geometry. Converting from <code>post_table</code> also includes the coordinate columns created by cubble.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># post_array</span></span>
<span><span class="va">arr</span> <span class="op">=</span> <span class="fu"><a href="../reference/as_post_array.html">as_post_array</a></span><span class="op">(</span><span class="va">polygons</span>,</span>
<span>                    geometry_summary <span class="op">=</span> <span class="va">summarise_geometry_bbox</span>, </span>
<span>                    rotated <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in st_minimum_rotated_rectangle.sfc(x_unioned):</span></span>
<span><span class="co">#&gt; st_minimum_rotated_rectangle does not work correctly for longitude/latitude</span></span>
<span><span class="co">#&gt; data</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">arr</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 25 features and 2 fields</span></span>
<span><span class="co">#&gt; Active geometry column: geometry</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -0.2974337 ymin: -0.00297557 xmax: 0.9730806 ymax: 1.153558</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; # A tibble: 25 × 4</span></span>
<span><span class="co">#&gt;    gid                             geom_sum datetime                    geometry</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                      &lt;POLYGON [°]&gt; &lt;date&gt;                 &lt;POLYGON [°]&gt;</span></span>
<span><span class="co">#&gt;  1 a     ((0.5137787 1.117004, 0.9005707 0… 2020-10-01 ((0.5474949 0.8088912, 0…</span></span>
<span><span class="co">#&gt;  2 a     ((0.5137787 1.117004, 0.9005707 0… 2020-10-02 ((0.4961102 0.8728385, 0…</span></span>
<span><span class="co">#&gt;  3 a     ((0.5137787 1.117004, 0.9005707 0… 2020-10-03 ((0.5578801 0.8616378, 0…</span></span>
<span><span class="co">#&gt;  4 a     ((0.5137787 1.117004, 0.9005707 0… 2020-10-04 ((0.5652241 0.872057, 0.…</span></span>
<span><span class="co">#&gt;  5 a     ((0.5137787 1.117004, 0.9005707 0… 2020-10-05 ((0.6063791 0.8304178, 0…</span></span>
<span><span class="co">#&gt;  6 b     ((-0.008469583 1.165177, 0.379644… 2020-10-01 ((0.2791708 0.8337388, -…</span></span>
<span><span class="co">#&gt;  7 b     ((-0.008469583 1.165177, 0.379644… 2020-10-02 ((0.3298312 0.7612067, -…</span></span>
<span><span class="co">#&gt;  8 b     ((-0.008469583 1.165177, 0.379644… 2020-10-03 ((0.3796448 0.767853, -0…</span></span>
<span><span class="co">#&gt;  9 b     ((-0.008469583 1.165177, 0.379644… 2020-10-04 ((0.3642467 0.779727, -0…</span></span>
<span><span class="co">#&gt; 10 b     ((-0.008469583 1.165177, 0.379644… 2020-10-05 ((0.2665368 0.8649996, -…</span></span>
<span><span class="co">#&gt; # ℹ 15 more rows</span></span>
<span><span class="co"># post_table</span></span>
<span><span class="va">tab</span> <span class="op">=</span> <span class="fu"><a href="../reference/as_post_table.html">as_post_table</a></span><span class="op">(</span><span class="va">polygons</span>,</span>
<span>                    geometry_summary <span class="op">=</span> <span class="va">summarise_geometry_bbox</span>, </span>
<span>                    rotated <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in st_minimum_rotated_rectangle.sfc(x_unioned):</span></span>
<span><span class="co">#&gt; st_minimum_rotated_rectangle does not work correctly for longitude/latitude</span></span>
<span><span class="co">#&gt; data</span></span>
<span><span class="co">#&gt; Warning: st_centroid assumes attributes are constant over geometries</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 25 features and 4 fields</span></span>
<span><span class="co">#&gt; Active geometry column: geometry</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -0.2974337 ymin: -0.00297557 xmax: 0.9730806 ymax: 1.153558</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; # A tibble: 25 × 6</span></span>
<span><span class="co">#&gt;    gid      long   lat                                       geom_sum datetime  </span></span>
<span><span class="co">#&gt;    &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;                                  &lt;POLYGON [°]&gt; &lt;date&gt;    </span></span>
<span><span class="co">#&gt;  1 a      0.638  0.885 ((0.5137787 1.117004, 0.9005707 0.866971, 0.7… 2020-10-01</span></span>
<span><span class="co">#&gt;  2 a      0.638  0.885 ((0.5137787 1.117004, 0.9005707 0.866971, 0.7… 2020-10-02</span></span>
<span><span class="co">#&gt;  3 a      0.638  0.885 ((0.5137787 1.117004, 0.9005707 0.866971, 0.7… 2020-10-03</span></span>
<span><span class="co">#&gt;  4 a      0.638  0.885 ((0.5137787 1.117004, 0.9005707 0.866971, 0.7… 2020-10-04</span></span>
<span><span class="co">#&gt;  5 a      0.638  0.885 ((0.5137787 1.117004, 0.9005707 0.866971, 0.7… 2020-10-05</span></span>
<span><span class="co">#&gt;  6 b     -0.0180 0.768 ((-0.008469583 1.165177, 0.3796448 0.767853, … 2020-10-01</span></span>
<span><span class="co">#&gt;  7 b     -0.0180 0.768 ((-0.008469583 1.165177, 0.3796448 0.767853, … 2020-10-02</span></span>
<span><span class="co">#&gt;  8 b     -0.0180 0.768 ((-0.008469583 1.165177, 0.3796448 0.767853, … 2020-10-03</span></span>
<span><span class="co">#&gt;  9 b     -0.0180 0.768 ((-0.008469583 1.165177, 0.3796448 0.767853, … 2020-10-04</span></span>
<span><span class="co">#&gt; 10 b     -0.0180 0.768 ((-0.008469583 1.165177, 0.3796448 0.767853, … 2020-10-05</span></span>
<span><span class="co">#&gt; # ℹ 15 more rows</span></span>
<span><span class="co">#&gt; # ℹ 1 more variable: geometry &lt;POLYGON [°]&gt;</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="crs-transformation">CRS transformation<a class="anchor" aria-label="anchor" href="#crs-transformation"></a>
</h3>
<!-- TODO: check if/why `st_crs<-` should work for post_array as well, skipped for now -->
<p>When transforming the CRS, both the changing and the summary geometry are updated within the <code>post_*</code> object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># post_array</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">arr</span>, <span class="fl">3035</span><span class="op">)</span></span>
<span><span class="co">#&gt; stars object with 2 dimensions and 1 attribute</span></span>
<span><span class="co">#&gt; attribute(s):</span></span>
<span><span class="co">#&gt;          geometry  </span></span>
<span><span class="co">#&gt;  POLYGON      :25  </span></span>
<span><span class="co">#&gt;  epsg:3035    : 0  </span></span>
<span><span class="co">#&gt;  +proj=laea...: 0  </span></span>
<span><span class="co">#&gt; dimension(s):</span></span>
<span><span class="co">#&gt;          from to     offset  delta                       refsys point</span></span>
<span><span class="co">#&gt; geom_sum    1  5         NA     NA ETRS89-extended / LAEA Eu... FALSE</span></span>
<span><span class="co">#&gt; datetime    1  5 2020-10-01 1 days                         Date FALSE</span></span>
<span><span class="co">#&gt;                                                                 values</span></span>
<span><span class="co">#&gt; geom_sum POLYGON ((3155515 -218766...,...,POLYGON ((3172602 -230105...</span></span>
<span><span class="co">#&gt; datetime                                                          NULL</span></span>
<span><span class="co"># post_table</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">tab</span>, <span class="fl">3035</span><span class="op">)</span></span>
<span><span class="co">#&gt; # cubble:   key: gid [5], index: datetime, nested form, [sf]</span></span>
<span><span class="co">#&gt; # spatial:  [3039847.61, -2301054.31, 3209654.79, -2175848.01], ETRS89-extended</span></span>
<span><span class="co">#&gt; #   / LAEA Europe</span></span>
<span><span class="co">#&gt; # temporal: datetime [date], geometry [POLYGON [m]]</span></span>
<span><span class="co">#&gt;   gid      long   lat                                             geom_sum ts   </span></span>
<span><span class="co">#&gt; * &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;                                        &lt;POLYGON [m]&gt; &lt;lis&gt;</span></span>
<span><span class="co">#&gt; 1 a      0.638  0.885 ((3155515 -2187663, 3201614 -2217596, 3183656 -2237… &lt;sf&gt; </span></span>
<span><span class="co">#&gt; 2 b     -0.0180 0.768 ((3091893 -2175848, 3137266 -2220797, 3085228 -2255… &lt;sf&gt; </span></span>
<span><span class="co">#&gt; 3 c      0.402  0.507 ((3131201 -2224770, 3166375 -2248651, 3146055 -2269… &lt;sf&gt; </span></span>
<span><span class="co">#&gt; 4 d      0.744  0.341 ((3171061 -2243942, 3209655 -2274048, 3188598 -2292… &lt;sf&gt; </span></span>
<span><span class="co">#&gt; 5 e      0.467  0.180 ((3172602 -2301054, 3117186 -2296926, 3117310 -2260… &lt;sf&gt;</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">tab</span>, <span class="fl">3035</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://huizezhang-sherry.github.io/cubble/reference/face.html" class="external-link">face_temporal</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # cubble:   key: gid [5], index: datetime, long form</span></span>
<span><span class="co">#&gt; # temporal: 2020-10-01 -- 2020-10-05 [1D], no gaps</span></span>
<span><span class="co">#&gt; # spatial:  long [dbl], lat [dbl], geom_sum [POLYGON [m]]</span></span>
<span><span class="co">#&gt;    gid   datetime                                                       geometry</span></span>
<span><span class="co">#&gt;  * &lt;chr&gt; &lt;date&gt;                                                    &lt;POLYGON [m]&gt;</span></span>
<span><span class="co">#&gt;  1 a     2020-10-01 ((3158048 -2218898, 3151083 -2210627, 3159756 -2196590, 319…</span></span>
<span><span class="co">#&gt;  2 a     2020-10-02 ((3152082 -2211840, 3145122 -2203563, 3153799 -2189527, 318…</span></span>
<span><span class="co">#&gt;  3 a     2020-10-03 ((3159592 -2213763, 3161300 -2191451, 3195825 -2213869, 315…</span></span>
<span><span class="co">#&gt;  4 a     2020-10-04 ((3160545 -2212817, 3161802 -2196385, 3187231 -2212904, 316…</span></span>
<span><span class="co">#&gt;  5 a     2020-10-05 ((3165375 -2217510, 3158407 -2209244, 3167076 -2195200, 320…</span></span>
<span><span class="co">#&gt;  6 b     2020-10-01 ((3125303 -2212881, 3055244 -2223078, 3055592 -2221881, 305…</span></span>
<span><span class="co">#&gt;  7 b     2020-10-02 ((3131127 -2220801, 3061050 -2231032, 3061397 -2229835, 306…</span></span>
<span><span class="co">#&gt;  8 b     2020-10-03 ((3137266 -2220797, 3067191 -2231067, 3104291 -2188180, 313…</span></span>
<span><span class="co">#&gt;  9 b     2020-10-04 ((3135442 -2219407, 3075499 -2228212, 3107229 -2191506, 313…</span></span>
<span><span class="co">#&gt; 10 b     2020-10-05 ((3123921 -2209589, 3053870 -2219778, 3054218 -2218581, 305…</span></span>
<span><span class="co">#&gt; # ℹ 15 more rows</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="sec-binary">Geometric binary predicates<a class="anchor" aria-label="anchor" href="#sec-binary"></a>
</h3>
<p>Geometric binary predicates (<code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">?sf::geos_binary_pred</a></code>) are supported by <code>post_*</code> objects in different ways.</p>
<p>In <code>post_array</code> objects, you can apply geometric binary predicates to the changing geometries with the function <code><a href="../reference/binary-predicates-post-array.html">st_mask()</a></code>. The result is a one column matrix as the result of any features in y relating to any feature in x. If you still want to get the relation through a binary predicate as it works in <code>sf</code>, then you should call the function on the changing geometries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/binary-predicates-post-array.html">st_mask</a></span><span class="op">(</span><span class="va">arr</span>, <span class="va">circles</span>, .predicate <span class="op">=</span> <span class="va">st_disjoint</span><span class="op">)</span></span>
<span><span class="co">#&gt;        [,1]</span></span>
<span><span class="co">#&gt;  [1,]  TRUE</span></span>
<span><span class="co">#&gt;  [2,]  TRUE</span></span>
<span><span class="co">#&gt;  [3,]  TRUE</span></span>
<span><span class="co">#&gt;  [4,]  TRUE</span></span>
<span><span class="co">#&gt;  [5,]  TRUE</span></span>
<span><span class="co">#&gt;  [6,]  TRUE</span></span>
<span><span class="co">#&gt;  [7,]  TRUE</span></span>
<span><span class="co">#&gt;  [8,]  TRUE</span></span>
<span><span class="co">#&gt;  [9,] FALSE</span></span>
<span><span class="co">#&gt; [10,]  TRUE</span></span>
<span><span class="co">#&gt; [11,]  TRUE</span></span>
<span><span class="co">#&gt; [12,]  TRUE</span></span>
<span><span class="co">#&gt; [13,]  TRUE</span></span>
<span><span class="co">#&gt; [14,] FALSE</span></span>
<span><span class="co">#&gt; [15,]  TRUE</span></span>
<span><span class="co">#&gt; [16,]  TRUE</span></span>
<span><span class="co">#&gt; [17,]  TRUE</span></span>
<span><span class="co">#&gt; [18,]  TRUE</span></span>
<span><span class="co">#&gt; [19,]  TRUE</span></span>
<span><span class="co">#&gt; [20,]  TRUE</span></span>
<span><span class="co">#&gt; [21,]  TRUE</span></span>
<span><span class="co">#&gt; [22,]  TRUE</span></span>
<span><span class="co">#&gt; [23,]  TRUE</span></span>
<span><span class="co">#&gt; [24,]  TRUE</span></span>
<span><span class="co">#&gt; [25,]  TRUE</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_disjoint</a></span><span class="op">(</span><span class="va">arr</span><span class="op">$</span><span class="va">geometry</span>, <span class="va">circles</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sparse geometry binary predicate list of length 25, where the predicate</span></span>
<span><span class="co">#&gt; was `disjoint'</span></span>
<span><span class="co">#&gt; first 10 elements:</span></span>
<span><span class="co">#&gt;  1: 1, 2</span></span>
<span><span class="co">#&gt;  2: 1, 2</span></span>
<span><span class="co">#&gt;  3: 2</span></span>
<span><span class="co">#&gt;  4: 1</span></span>
<span><span class="co">#&gt;  5: 1, 2</span></span>
<span><span class="co">#&gt;  6: 1, 2</span></span>
<span><span class="co">#&gt;  7: 1, 2</span></span>
<span><span class="co">#&gt;  8: 2</span></span>
<span><span class="co">#&gt;  9: (empty)</span></span>
<span><span class="co">#&gt;  10: 1, 2</span></span></code></pre></div>
</div>
<p>With this in mind, we can also create a new dimension with the result of a binary predicate geometric operation, similar to a mask. Since this is a new attribute in our cube, the dimensions are preserved.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">arr</span><span class="op">$</span><span class="va">int_circles</span> <span class="op">=</span> <span class="fu"><a href="../reference/binary-predicates-post-array.html">st_mask</a></span><span class="op">(</span><span class="va">arr</span>, <span class="va">circles</span><span class="op">)</span></span>
<span><span class="va">arr</span></span>
<span><span class="co">#&gt; stars object with 2 dimensions and 2 attributes</span></span>
<span><span class="co">#&gt; attribute(s):</span></span>
<span><span class="co">#&gt;          geometry   int_circles    </span></span>
<span><span class="co">#&gt;  POLYGON      :25   Mode :logical  </span></span>
<span><span class="co">#&gt;  epsg:4326    : 0   FALSE:16       </span></span>
<span><span class="co">#&gt;  +proj=long...: 0   TRUE :9        </span></span>
<span><span class="co">#&gt; dimension(s):</span></span>
<span><span class="co">#&gt;          from to     offset  delta refsys point</span></span>
<span><span class="co">#&gt; geom_sum    1  5         NA     NA WGS 84 FALSE</span></span>
<span><span class="co">#&gt; datetime    1  5 2020-10-01 1 days   Date FALSE</span></span>
<span><span class="co">#&gt;                                                                 values</span></span>
<span><span class="co">#&gt; geom_sum POLYGON ((0.5137787 1.117...,...,POLYGON ((0.6988282 0.004...</span></span>
<span><span class="co">#&gt; datetime                                                          NULL</span></span>
<span><span class="fu"><a href="../reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">arr</span>, <span class="va">int_circles</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">circles</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="post03_compatibility_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>For <code>post_table</code> objects, the predicates can be applied to either the spatial or the temporal face of the vector data cube.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_disjoint</a></span><span class="op">(</span><span class="va">tab</span>, <span class="va">circles</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sparse geometry binary predicate list of length 5, where the predicate</span></span>
<span><span class="co">#&gt; was `disjoint'</span></span>
<span><span class="co">#&gt;  1: 1, 2</span></span>
<span><span class="co">#&gt;  2: 1, 2</span></span>
<span><span class="co">#&gt;  3: 2</span></span>
<span><span class="co">#&gt;  4: (empty)</span></span>
<span><span class="co">#&gt;  5: 1</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_disjoint</a></span><span class="op">(</span><span class="fu"><a href="https://huizezhang-sherry.github.io/cubble/reference/face.html" class="external-link">face_temporal</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span>, <span class="va">circles</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sparse geometry binary predicate list of length 25, where the predicate</span></span>
<span><span class="co">#&gt; was `disjoint'</span></span>
<span><span class="co">#&gt; first 10 elements:</span></span>
<span><span class="co">#&gt;  1: 1, 2</span></span>
<span><span class="co">#&gt;  2: 1, 2</span></span>
<span><span class="co">#&gt;  3: 1, 2</span></span>
<span><span class="co">#&gt;  4: 1, 2</span></span>
<span><span class="co">#&gt;  5: 1, 2</span></span>
<span><span class="co">#&gt;  6: 1, 2</span></span>
<span><span class="co">#&gt;  7: 1, 2</span></span>
<span><span class="co">#&gt;  8: 1, 2</span></span>
<span><span class="co">#&gt;  9: 1, 2</span></span>
<span><span class="co">#&gt;  10: 1, 2</span></span></code></pre></div>
</div>
<p>Applying the predicate to the changing geometry of <code>post_array</code> objects renders the same result as applying it to the <code>post_table</code> objects in the long format or on its temporal face.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_disjoint</a></span><span class="op">(</span><span class="va">arr</span><span class="op">$</span><span class="va">geometry</span>, <span class="va">circles</span>, sparse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 39</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_disjoint</a></span><span class="op">(</span><span class="fu"><a href="https://huizezhang-sherry.github.io/cubble/reference/face.html" class="external-link">face_temporal</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span>, <span class="va">circles</span>, sparse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 39</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="sec-spatfilt">Spatial filtering<a class="anchor" aria-label="anchor" href="#sec-spatfilt"></a>
</h3>
<p>The predicates shown above are particularly relevant to use inside spatial filtering operations.</p>
<p><code><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">sf::st_filter()</a></code> does not work on <code>post_array</code> objects. See <a href="#sec-binary" class="quarto-xref">Section 3.3</a> for an example on how to mask the cube values spatially.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_filter</a></span><span class="op">(</span><span class="va">arr</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in UseMethod("st_filter"): no applicable method for 'st_filter' applied to an object of class "c('post_array', 'stars')"</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_filter</a></span><span class="op">(</span><span class="va">arr</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in UseMethod("st_filter"): no applicable method for 'st_filter' applied to an object of class "c('sfc_POLYGON', 'sfc')"</span></span></code></pre></div>
</div>
<p>But it does work on <code>post_table</code> objects, both for the spatial and temporal face.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_filter</a></span><span class="op">(</span><span class="va">tab</span>, <span class="va">circles</span><span class="op">)</span></span>
<span><span class="co">#&gt; # cubble:   key: gid [3], index: datetime, nested form, [sf]</span></span>
<span><span class="co">#&gt; # spatial:  [0.18, -0.01, 0.99, 0.72], WGS 84</span></span>
<span><span class="co">#&gt; # temporal: datetime [date], geometry [POLYGON [°]]</span></span>
<span><span class="co">#&gt;   gid    long   lat                                               geom_sum ts   </span></span>
<span><span class="co">#&gt; * &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;                                          &lt;POLYGON [°]&gt; &lt;lis&gt;</span></span>
<span><span class="co">#&gt; 1 c     0.402 0.507 ((0.3321185 0.7217665, 0.6273178 0.5211933, 0.4712468… &lt;sf&gt; </span></span>
<span><span class="co">#&gt; 2 d     0.744 0.341 ((0.6633875 0.5730321, 0.9881167 0.3122207, 0.8247802… &lt;sf&gt; </span></span>
<span><span class="co">#&gt; 3 e     0.467 0.180 ((0.6988282 0.004623805, 0.2489107 -0.01302429, 0.234… &lt;sf&gt;</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_filter</a></span><span class="op">(</span><span class="fu"><a href="https://huizezhang-sherry.github.io/cubble/reference/face.html" class="external-link">face_temporal</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span>, <span class="va">circles</span><span class="op">)</span></span>
<span><span class="co">#&gt; # cubble:   key: gid [2], index: datetime, long form</span></span>
<span><span class="co">#&gt; # temporal: 2020-10-01 -- 2020-10-05 [1D], has gaps!</span></span>
<span><span class="co">#&gt; # spatial:  long [dbl], lat [dbl], geom_sum [POLYGON [°]]</span></span>
<span><span class="co">#&gt;   gid   datetime                                                        geometry</span></span>
<span><span class="co">#&gt; * &lt;chr&gt; &lt;date&gt;                                                     &lt;POLYGON [°]&gt;</span></span>
<span><span class="co">#&gt; 1 c     2020-10-01 ((0.2807462 0.6277986, 0.3325024 0.7215057, 0.5164992 0.5964…</span></span>
<span><span class="co">#&gt; 2 c     2020-10-02 ((0.328914 0.5687438, 0.3806701 0.6624509, 0.5646669 0.53743…</span></span>
<span><span class="co">#&gt; 3 c     2020-10-03 ((0.2897647 0.6168588, 0.3415208 0.710566, 0.5357965 0.49222…</span></span>
<span><span class="co">#&gt; 4 c     2020-10-05 ((0.2145846 0.5285578, 0.2663408 0.6222649, 0.4503375 0.4972…</span></span>
<span><span class="co">#&gt; 5 d     2020-10-01 ((0.7650701 0.4744459, 0.8787185 0.375316, 0.8266421 0.28905…</span></span>
<span><span class="co">#&gt; 6 d     2020-10-02 ((0.7217233 0.5261787, 0.8353717 0.4270488, 0.7832953 0.3407…</span></span>
<span><span class="co">#&gt; 7 d     2020-10-03 ((0.6752472 0.4565396, 0.7888956 0.3574097, 0.6915808 0.2158…</span></span>
<span><span class="co">#&gt; 8 d     2020-10-04 ((0.6687306 0.4190113, 0.7593946 0.3399296, 0.6862765 0.2335…</span></span>
<span><span class="co">#&gt; 9 d     2020-10-05 ((0.8594322 0.4155757, 0.9730806 0.3164458, 0.9210042 0.2301…</span></span></code></pre></div>
</div>
<p>When a spatial filtering needs to be applied to the changing geometry of a <code>post_array</code> object, we can first convert to <code>post_table</code>, perform the filtering on the temporal face and then convert back to a <code>post_array</code> object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">arr</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/as_post_table.html">as_post_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://huizezhang-sherry.github.io/cubble/reference/face.html" class="external-link">face_temporal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_filter</a></span><span class="op">(</span><span class="va">circles</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/as_post_array.html">as_post_array</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: st_centroid assumes attributes are constant over geometries</span></span>
<span><span class="co">#&gt; stars object with 2 dimensions and 2 attributes</span></span>
<span><span class="co">#&gt; attribute(s):</span></span>
<span><span class="co">#&gt;          geometry   int_circles   </span></span>
<span><span class="co">#&gt;  POLYGON      :10   Mode:logical  </span></span>
<span><span class="co">#&gt;  epsg:4326    : 0   TRUE:9        </span></span>
<span><span class="co">#&gt;  +proj=long...: 0   NA's:1        </span></span>
<span><span class="co">#&gt; dimension(s):</span></span>
<span><span class="co">#&gt;          from to     offset  delta refsys point</span></span>
<span><span class="co">#&gt; geom_sum    1  2         NA     NA WGS 84 FALSE</span></span>
<span><span class="co">#&gt; datetime    1  5 2020-10-01 1 days   Date FALSE</span></span>
<span><span class="co">#&gt;                                                                  values</span></span>
<span><span class="co">#&gt; geom_sum POLYGON ((0.3321 0.7218, 0...., POLYGON ((0.6634 0.573, 0.9...</span></span>
<span><span class="co">#&gt; datetime                                                           NULL</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="geometric-measurements-and-unary-operations">Geometric measurements and unary operations<a class="anchor" aria-label="anchor" href="#geometric-measurements-and-unary-operations"></a>
</h3>
<p>Geometric measurements (<code><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">?sf::geos_measures</a></code>) can be applied to the summary and changing geometries as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># post_array</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">arr</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Units: [m^2]</span></span>
<span><span class="co">#&gt; [1] 1445426306 3909318595 1225404011 1343229189 2047852426</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">arr</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span></span>
<span><span class="co">#&gt; Units: [m^2]</span></span>
<span><span class="co">#&gt;  [1]  693272313 1537008395  394944271  392819049  585061160  693260956</span></span>
<span><span class="co">#&gt;  [7] 1537040160  394948297  392816498  585062691  405985931 1319132956</span></span>
<span><span class="co">#&gt; [13]  182397989  385893114  585064729  220231724  965402936   53657361</span></span>
<span><span class="co">#&gt; [19]  227321366  384440186  693268587 1536993945  394950797  392821562</span></span>
<span><span class="co">#&gt; [25]  585064518</span></span>
<span><span class="co">#post_table</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span></span>
<span><span class="co">#&gt; Units: [m^2]</span></span>
<span><span class="co">#&gt; [1] 1445426306 3909318595 1225404011 1343229189 2047852426</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="fu"><a href="https://huizezhang-sherry.github.io/cubble/reference/face.html" class="external-link">face_temporal</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Units: [m^2]</span></span>
<span><span class="co">#&gt;  [1]  693272313  693260956  405985931  220231724  693268587 1537008395</span></span>
<span><span class="co">#&gt;  [7] 1537040160 1319132956  965402936 1536993945  394944271  394948297</span></span>
<span><span class="co">#&gt; [13]  182397989   53657361  394950797  392819049  392816498  385893114</span></span>
<span><span class="co">#&gt; [19]  227321366  392821562  585061160  585062691  585064729  384440186</span></span>
<span><span class="co">#&gt; [25]  585064518</span></span></code></pre></div>
</div>
<p>Unary operations (<code><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">?sf::geos_unary</a></code>) can be applied to post objects but different behaviors are to be expected. For <code>post_array</code> the operation is performed on the changing geometries by extracting the geometries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_boundary</a></span><span class="op">(</span><span class="va">arr</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span></span>
<span><span class="co">#&gt; Geometry set for 25 features </span></span>
<span><span class="co">#&gt; Geometry type: LINESTRING</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -0.2974337 ymin: -0.00297557 xmax: 0.9730806 ymax: 1.153558</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; First 5 geometries:</span></span>
<span><span class="co">#&gt; LINESTRING (0.5474949 0.8088912, 0.4874872 0.88...</span></span>
<span><span class="co">#&gt; LINESTRING (0.2791708 0.8337388, -0.2847997 0.6...</span></span>
<span><span class="co">#&gt; LINESTRING (0.2807462 0.6277986, 0.3325024 0.72...</span></span>
<span><span class="co">#&gt; LINESTRING (0.7650701 0.4744459, 0.8787185 0.37...</span></span>
<span><span class="co">#&gt; LINESTRING (0.3825692 0.3537803, 0.5519791 0.36...</span></span></code></pre></div>
</div>
<p>If the operation is applied to a <code>post_table</code> the geometry column gets updated to the new geometry type.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: st_centroid assumes attributes are constant over geometries</span></span>
<span><span class="co">#&gt; # cubble:   key: gid [5], index: datetime, nested form, [sf]</span></span>
<span><span class="co">#&gt; # spatial:  [-0.02, 0.18, 0.74, 0.89], WGS 84</span></span>
<span><span class="co">#&gt; # temporal: datetime [date], geometry [POLYGON [°]]</span></span>
<span><span class="co">#&gt;   gid      long   lat                geom_sum ts          </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;             &lt;POINT [°]&gt; &lt;list&gt;      </span></span>
<span><span class="co">#&gt; 1 a      0.638  0.885   (0.6382744 0.8853982) &lt;sf [5 × 2]&gt;</span></span>
<span><span class="co">#&gt; 2 b     -0.0180 0.768 (-0.01803554 0.7676183) &lt;sf [5 × 2]&gt;</span></span>
<span><span class="co">#&gt; 3 c      0.402  0.507   (0.4016835 0.5066305) &lt;sf [5 × 2]&gt;</span></span>
<span><span class="co">#&gt; 4 d      0.744  0.341   (0.7440853 0.3409447) &lt;sf [5 × 2]&gt;</span></span>
<span><span class="co">#&gt; 5 e      0.467  0.180   (0.4666607 0.1795801) &lt;sf [5 × 2]&gt;</span></span></code></pre></div>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">tab</span><span class="op">$</span><span class="va">geom_sum</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span><span class="op">$</span><span class="va">geom_sum</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: st_centroid assumes attributes are constant over geometries</span></span></code></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="post03_compatibility_files/figure-html/unnamed-chunk-24-1.png" width="816"></p>
<figcaption>Original summary geometry: minimum rotated rectangle</figcaption></figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="post03_compatibility_files/figure-html/unnamed-chunk-24-2.png" width="816"></p>
<figcaption>Updated summary geometry: centroid</figcaption></figure>
</div>
</div>
</div>
</div>
</section></section><section class="level2"><h2 id="dplyr-compatibility">
<code>dplyr</code> compatibility<a class="anchor" aria-label="anchor" href="#dplyr-compatibility"></a>
</h2>
<p>Both post classes support <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a> methods as long as they don’t alter the vector data cube structure. See the available methods in <code>?dplyr-post-array</code> and <code>?dplyr-post-table</code>. Some specific behaviors of these functions are explained below.</p>
<section class="level3"><h3 id="modifying-columns">Modifying columns<a class="anchor" aria-label="anchor" href="#modifying-columns"></a>
</h3>
<p>The <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate()</a></code> function modifies the existing object by creating or modifying existing columns. It is useful in combination with geometric measurement functions from sf. For instance, we can compute the area of the changing geometry as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">arr</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>area <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; stars object with 2 dimensions and 3 attributes</span></span>
<span><span class="co">#&gt; attribute(s):</span></span>
<span><span class="co">#&gt;          geometry   int_circles       area [m^2]       </span></span>
<span><span class="co">#&gt;  POLYGON      :25   Mode :logical   Min.   :5.366e+07  </span></span>
<span><span class="co">#&gt;  epsg:4326    : 0   FALSE:16        1st Qu.:3.928e+08  </span></span>
<span><span class="co">#&gt;  +proj=long...: 0   TRUE :9         Median :4.060e+08  </span></span>
<span><span class="co">#&gt;                                     Mean   :6.216e+08  </span></span>
<span><span class="co">#&gt;                                     3rd Qu.:6.933e+08  </span></span>
<span><span class="co">#&gt;                                     Max.   :1.537e+09  </span></span>
<span><span class="co">#&gt; dimension(s):</span></span>
<span><span class="co">#&gt;          from to     offset  delta refsys point</span></span>
<span><span class="co">#&gt; geom_sum    1  5         NA     NA WGS 84 FALSE</span></span>
<span><span class="co">#&gt; datetime    1  5 2020-10-01 1 days   Date FALSE</span></span>
<span><span class="co">#&gt;                                                                 values</span></span>
<span><span class="co">#&gt; geom_sum POLYGON ((0.5137787 1.117...,...,POLYGON ((0.6988282 0.004...</span></span>
<span><span class="co">#&gt; datetime                                                          NULL</span></span>
<span><span class="va">tab</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://huizezhang-sherry.github.io/cubble/reference/face.html" class="external-link">face_temporal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>area <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # cubble:   key: gid [5], index: datetime, long form</span></span>
<span><span class="co">#&gt; # temporal: 2020-10-01 -- 2020-10-05 [1D], no gaps</span></span>
<span><span class="co">#&gt; # spatial:  long [dbl], lat [dbl], geom_sum [POLYGON [°]]</span></span>
<span><span class="co">#&gt;    gid   datetime                                                geometry   area</span></span>
<span><span class="co">#&gt;  * &lt;chr&gt; &lt;date&gt;                                             &lt;POLYGON [°]&gt;  [m^2]</span></span>
<span><span class="co">#&gt;  1 a     2020-10-01 ((0.5474949 0.8088912, 0.4874872 0.8838477, 0.552005… 6.93e8</span></span>
<span><span class="co">#&gt;  2 a     2020-10-02 ((0.4961102 0.8728385, 0.4361026 0.947795, 0.5006209… 6.93e8</span></span>
<span><span class="co">#&gt;  3 a     2020-10-03 ((0.5578801 0.8616378, 0.5623908 1.085448, 0.8520717… 4.06e8</span></span>
<span><span class="co">#&gt;  4 a     2020-10-04 ((0.5652241 0.872057, 0.5685463 1.036898, 0.7819022 … 2.20e8</span></span>
<span><span class="co">#&gt;  5 a     2020-10-05 ((0.6063791 0.8304178, 0.5463715 0.9053744, 0.610889… 6.93e8</span></span>
<span><span class="co">#&gt;  6 b     2020-10-01 ((0.2791708 0.8337388, -0.2847997 0.6540191, -0.2825… 1.54e9</span></span>
<span><span class="co">#&gt;  7 b     2020-10-02 ((0.3298312 0.7612067, -0.2341393 0.5814869, -0.2318… 1.54e9</span></span>
<span><span class="co">#&gt;  8 b     2020-10-03 ((0.3796448 0.767853, -0.1843257 0.5881332, 0.097774… 1.32e9</span></span>
<span><span class="co">#&gt;  9 b     2020-10-04 ((0.3642467 0.779727, -0.1182199 0.6259799, 0.123111… 9.65e8</span></span>
<span><span class="co">#&gt; 10 b     2020-10-05 ((0.2665368 0.8649996, -0.2974337 0.6852798, -0.2951… 1.54e9</span></span>
<span><span class="co">#&gt; # ℹ 15 more rows</span></span></code></pre></div>
</div>
<p>For <code>post_table</code> objects it is also possible to use them in the summary geoemtry.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tab</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>area <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">geom_sum</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # cubble:   key: gid [5], index: datetime, nested form, [sf]</span></span>
<span><span class="co">#&gt; # spatial:  [-0.42, -0.01, 0.99, 1.17], WGS 84</span></span>
<span><span class="co">#&gt; # temporal: datetime [date], geometry [POLYGON [°]]</span></span>
<span><span class="co">#&gt;   gid      long   lat                                      geom_sum ts      area</span></span>
<span><span class="co">#&gt; * &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;                                 &lt;POLYGON [°]&gt; &lt;lis&gt;  [m^2]</span></span>
<span><span class="co">#&gt; 1 a      0.638  0.885 ((0.5137787 1.117004, 0.9005707 0.866971, 0.… &lt;sf&gt;  1.45e9</span></span>
<span><span class="co">#&gt; 2 b     -0.0180 0.768 ((-0.008469583 1.165177, 0.3796448 0.767853,… &lt;sf&gt;  3.91e9</span></span>
<span><span class="co">#&gt; 3 c      0.402  0.507 ((0.3321185 0.7217665, 0.6273178 0.5211933, … &lt;sf&gt;  1.23e9</span></span>
<span><span class="co">#&gt; 4 d      0.744  0.341 ((0.6633875 0.5730321, 0.9881167 0.3122207, … &lt;sf&gt;  1.34e9</span></span>
<span><span class="co">#&gt; 5 e      0.467  0.180 ((0.6988282 0.004623805, 0.2489107 -0.013024… &lt;sf&gt;  2.05e9</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="sticky-geometry">Sticky geometry<a class="anchor" aria-label="anchor" href="#sticky-geometry"></a>
</h3>
<p>Following the sf design of an sticky geometry, both <code>post_array</code> and <code>post_table</code> methods, as spatial or temporal cubes have sticky geometries when applying dplyr methods.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">arr2</span> <span class="op">=</span> <span class="va">arr</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    area <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span>,</span>
<span>    perimeter <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_perimeter</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; stars object with 2 dimensions and 4 attributes</span></span>
<span><span class="co">#&gt; attribute(s):</span></span>
<span><span class="co">#&gt;          geometry   int_circles       area [m^2]        perimeter [m]   </span></span>
<span><span class="co">#&gt;  POLYGON      :25   Mode :logical   Min.   :5.366e+07   Min.   : 40715  </span></span>
<span><span class="co">#&gt;  epsg:4326    : 0   FALSE:16        1st Qu.:3.928e+08   1st Qu.: 80659  </span></span>
<span><span class="co">#&gt;  +proj=long...: 0   TRUE :9         Median :4.060e+08   Median : 96203  </span></span>
<span><span class="co">#&gt;                                     Mean   :6.216e+08   Mean   :102089  </span></span>
<span><span class="co">#&gt;                                     3rd Qu.:6.933e+08   3rd Qu.:107075  </span></span>
<span><span class="co">#&gt;                                     Max.   :1.537e+09   Max.   :172705  </span></span>
<span><span class="co">#&gt; dimension(s):</span></span>
<span><span class="co">#&gt;          from to     offset  delta refsys point</span></span>
<span><span class="co">#&gt; geom_sum    1  5         NA     NA WGS 84 FALSE</span></span>
<span><span class="co">#&gt; datetime    1  5 2020-10-01 1 days   Date FALSE</span></span>
<span><span class="co">#&gt;                                                                 values</span></span>
<span><span class="co">#&gt; geom_sum POLYGON ((0.5137787 1.117...,...,POLYGON ((0.6988282 0.004...</span></span>
<span><span class="co">#&gt; datetime                                                          NULL</span></span>
<span><span class="va">arr2</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">perimeter</span><span class="op">)</span></span>
<span><span class="co">#&gt; stars object with 2 dimensions and 2 attributes</span></span>
<span><span class="co">#&gt; attribute(s):</span></span>
<span><span class="co">#&gt;  perimeter [m]            geometry  </span></span>
<span><span class="co">#&gt;  Min.   : 40715   POLYGON      :25  </span></span>
<span><span class="co">#&gt;  1st Qu.: 80659   epsg:4326    : 0  </span></span>
<span><span class="co">#&gt;  Median : 96203   +proj=long...: 0  </span></span>
<span><span class="co">#&gt;  Mean   :102089                     </span></span>
<span><span class="co">#&gt;  3rd Qu.:107075                     </span></span>
<span><span class="co">#&gt;  Max.   :172705                     </span></span>
<span><span class="co">#&gt; dimension(s):</span></span>
<span><span class="co">#&gt;          from to     offset  delta refsys point</span></span>
<span><span class="co">#&gt; geom_sum    1  5         NA     NA WGS 84 FALSE</span></span>
<span><span class="co">#&gt; datetime    1  5 2020-10-01 1 days   Date FALSE</span></span>
<span><span class="co">#&gt;                                                                 values</span></span>
<span><span class="co">#&gt; geom_sum POLYGON ((0.5137787 1.117...,...,POLYGON ((0.6988282 0.004...</span></span>
<span><span class="co">#&gt; datetime                                                          NULL</span></span></code></pre></div>
</div>
<p>For <code>post_table</code> objects, cubble also applies a sticky concept for the <code>key</code> (<code>group_id</code>), <code>index</code> (<code>time_column</code>) and <code>coords</code>, and prints a message to inform you about it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">tab2</span> <span class="op">=</span> <span class="va">tab</span> <span class="op">|&gt;</span> </span>
<span>   <span class="fu"><a href="https://huizezhang-sherry.github.io/cubble/reference/face.html" class="external-link">face_temporal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      area <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span>,</span>
<span>      perimeter <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_perimeter</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # cubble:   key: gid [5], index: datetime, long form</span></span>
<span><span class="co">#&gt; # temporal: 2020-10-01 -- 2020-10-05 [1D], no gaps</span></span>
<span><span class="co">#&gt; # spatial:  long [dbl], lat [dbl], geom_sum [POLYGON [°]]</span></span>
<span><span class="co">#&gt;    gid   datetime                                      geometry   area perimeter</span></span>
<span><span class="co">#&gt;  * &lt;chr&gt; &lt;date&gt;                                   &lt;POLYGON [°]&gt;  [m^2]       [m]</span></span>
<span><span class="co">#&gt;  1 a     2020-10-01 ((0.5474949 0.8088912, 0.4874872 0.8838477… 6.93e8   107076.</span></span>
<span><span class="co">#&gt;  2 a     2020-10-02 ((0.4961102 0.8728385, 0.4361026 0.947795,… 6.93e8   107075.</span></span>
<span><span class="co">#&gt;  3 a     2020-10-03 ((0.5578801 0.8616378, 0.5623908 1.085448,… 4.06e8    96203.</span></span>
<span><span class="co">#&gt;  4 a     2020-10-04 ((0.5652241 0.872057, 0.5685463 1.036898, … 2.20e8    70856.</span></span>
<span><span class="co">#&gt;  5 a     2020-10-05 ((0.6063791 0.8304178, 0.5463715 0.9053744… 6.93e8   107075.</span></span>
<span><span class="co">#&gt;  6 b     2020-10-01 ((0.2791708 0.8337388, -0.2847997 0.654019… 1.54e9   172703.</span></span>
<span><span class="co">#&gt;  7 b     2020-10-02 ((0.3298312 0.7612067, -0.2341393 0.581486… 1.54e9   172705.</span></span>
<span><span class="co">#&gt;  8 b     2020-10-03 ((0.3796448 0.767853, -0.1843257 0.5881332… 1.32e9   171452.</span></span>
<span><span class="co">#&gt;  9 b     2020-10-04 ((0.3642467 0.779727, -0.1182199 0.6259799… 9.65e8   146674.</span></span>
<span><span class="co">#&gt; 10 b     2020-10-05 ((0.2665368 0.8649996, -0.2974337 0.685279… 1.54e9   172702.</span></span>
<span><span class="co">#&gt; # ℹ 15 more rows</span></span>
<span><span class="va">tab2</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">perimeter</span><span class="op">)</span></span>
<span><span class="co">#&gt; ℹ Missing attribute `gid` and `datetime`, add it back.</span></span>
<span><span class="co">#&gt; # cubble:   key: gid [5], index: datetime, long form</span></span>
<span><span class="co">#&gt; # temporal: 2020-10-01 -- 2020-10-05 [1D], no gaps</span></span>
<span><span class="co">#&gt; # spatial:  long [dbl], lat [dbl], geom_sum [POLYGON [°]]</span></span>
<span><span class="co">#&gt;    gid   datetime   perimeter                                           geometry</span></span>
<span><span class="co">#&gt;  * &lt;chr&gt; &lt;date&gt;           [m]                                      &lt;POLYGON [°]&gt;</span></span>
<span><span class="co">#&gt;  1 a     2020-10-01   107076. ((0.5474949 0.8088912, 0.4874872 0.8838477, 0.552…</span></span>
<span><span class="co">#&gt;  2 a     2020-10-02   107075. ((0.4961102 0.8728385, 0.4361026 0.947795, 0.5006…</span></span>
<span><span class="co">#&gt;  3 a     2020-10-03    96203. ((0.5578801 0.8616378, 0.5623908 1.085448, 0.8520…</span></span>
<span><span class="co">#&gt;  4 a     2020-10-04    70856. ((0.5652241 0.872057, 0.5685463 1.036898, 0.78190…</span></span>
<span><span class="co">#&gt;  5 a     2020-10-05   107075. ((0.6063791 0.8304178, 0.5463715 0.9053744, 0.610…</span></span>
<span><span class="co">#&gt;  6 b     2020-10-01   172703. ((0.2791708 0.8337388, -0.2847997 0.6540191, -0.2…</span></span>
<span><span class="co">#&gt;  7 b     2020-10-02   172705. ((0.3298312 0.7612067, -0.2341393 0.5814869, -0.2…</span></span>
<span><span class="co">#&gt;  8 b     2020-10-03   171452. ((0.3796448 0.767853, -0.1843257 0.5881332, 0.097…</span></span>
<span><span class="co">#&gt;  9 b     2020-10-04   146674. ((0.3642467 0.779727, -0.1182199 0.6259799, 0.123…</span></span>
<span><span class="co">#&gt; 10 b     2020-10-05   172702. ((0.2665368 0.8649996, -0.2974337 0.6852798, -0.2…</span></span>
<span><span class="co">#&gt; # ℹ 15 more rows</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="wrangle-and-conversion">Wrangle and conversion<a class="anchor" aria-label="anchor" href="#wrangle-and-conversion"></a>
</h3>
<p>The usefulness of having two classes in <code>post</code> lies on the ability to apply certain functions in the tabular format and then other functions on the array format with conversion.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">arr2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/as_post_table.html">as_post_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://huizezhang-sherry.github.io/cubble/reference/face.html" class="external-link">face_temporal</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: st_centroid assumes attributes are constant over geometries</span></span>
<span><span class="co">#&gt; # cubble:   key: gid [5], index: datetime, long form</span></span>
<span><span class="co">#&gt; # temporal: 2020-10-01 -- 2020-10-05 [1D], no gaps</span></span>
<span><span class="co">#&gt; # spatial:  long [dbl], lat [dbl], geom_sum [POLYGON [°]]</span></span>
<span><span class="co">#&gt;    gid   datetime   int_circles        area perimeter                   geometry</span></span>
<span><span class="co">#&gt;  * &lt;chr&gt; &lt;date&gt;     &lt;lgl&gt;             [m^2]       [m]              &lt;POLYGON [°]&gt;</span></span>
<span><span class="co">#&gt;  1 a     2020-10-01 FALSE        693272313.   107076. ((0.5474949 0.8088912, 0.…</span></span>
<span><span class="co">#&gt;  2 a     2020-10-02 FALSE        693260956.   107075. ((0.4961102 0.8728385, 0.…</span></span>
<span><span class="co">#&gt;  3 a     2020-10-03 FALSE        405985931.    96203. ((0.5578801 0.8616378, 0.…</span></span>
<span><span class="co">#&gt;  4 a     2020-10-04 FALSE        220231724.    70856. ((0.5652241 0.872057, 0.5…</span></span>
<span><span class="co">#&gt;  5 a     2020-10-05 FALSE        693268587.   107075. ((0.6063791 0.8304178, 0.…</span></span>
<span><span class="co">#&gt;  6 b     2020-10-01 FALSE       1537008395.   172703. ((0.2791708 0.8337388, -0…</span></span>
<span><span class="co">#&gt;  7 b     2020-10-02 FALSE       1537040160.   172705. ((0.3298312 0.7612067, -0…</span></span>
<span><span class="co">#&gt;  8 b     2020-10-03 FALSE       1319132956.   171452. ((0.3796448 0.767853, -0.…</span></span>
<span><span class="co">#&gt;  9 b     2020-10-04 FALSE        965402936.   146674. ((0.3642467 0.779727, -0.…</span></span>
<span><span class="co">#&gt; 10 b     2020-10-05 FALSE       1536993945.   172702. ((0.2665368 0.8649996, -0…</span></span>
<span><span class="co">#&gt; # ℹ 15 more rows</span></span></code></pre></div>
</div>
<p>There are, however, certain issues to be taken into account when doing this.</p>
<section class="level4"><h4 id="post_table-cannot-be-created-from-an-empty-post_array-">1. <code>post_table</code> cannot be created from an empty <code>post_array</code>.<a class="anchor" aria-label="anchor" href="#post_table-cannot-be-created-from-an-empty-post_array-"></a>
</h4>
<p>If a filtering or subsetting operation is applied to a <code>post_array</code>, which can handle emptiness, when converting to a <code>post_table</code> we get an error.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/as_post_array.html">as_post_array</a></span><span class="op">(</span><span class="va">polygons</span><span class="op">)</span><span class="op">[</span><span class="va">circles</span><span class="op">]</span></span>
<span><span class="co">#&gt; stars object with 2 dimensions and 1 attribute</span></span>
<span><span class="co">#&gt; attribute(s):</span></span>
<span><span class="co">#&gt;          geometry </span></span>
<span><span class="co">#&gt;  POLYGON      :5  </span></span>
<span><span class="co">#&gt;  epsg:4326    :0  </span></span>
<span><span class="co">#&gt;  +proj=long...:0  </span></span>
<span><span class="co">#&gt; dimension(s):</span></span>
<span><span class="co">#&gt;          from to     offset  delta refsys point                values</span></span>
<span><span class="co">#&gt; geom_sum    4  4         NA     NA WGS 84  TRUE POINT (0.7628 0.3648)</span></span>
<span><span class="co">#&gt; datetime    1  5 2020-10-01 1 days   Date FALSE                  NULL</span></span>
<span><span class="fu"><a href="../reference/as_post_array.html">as_post_array</a></span><span class="op">(</span><span class="va">polygons</span><span class="op">)</span><span class="op">[</span><span class="va">circles</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/as_post_table.html">as_post_table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # cubble:   key: gid [1], index: datetime, nested form, [sf]</span></span>
<span><span class="co">#&gt; # spatial:  [0.76, 0.36, 0.76, 0.36], WGS 84</span></span>
<span><span class="co">#&gt; # temporal: datetime [date], geometry [POLYGON [°]]</span></span>
<span><span class="co">#&gt;   gid    long   lat              geom_sum ts          </span></span>
<span><span class="co">#&gt; * &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;           &lt;POINT [°]&gt; &lt;list&gt;      </span></span>
<span><span class="co">#&gt; 1 d     0.763 0.365 (0.7627982 0.3647986) &lt;sf [5 × 2]&gt;</span></span></code></pre></div>
</div>
<p>We can however have empty <code>post_table</code> objects by doing the filtering after conversion.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/as_post_array.html">as_post_array</a></span><span class="op">(</span><span class="va">polygons</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/as_post_table.html">as_post_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_filter</a></span><span class="op">(</span><span class="va">circles</span><span class="op">)</span></span>
<span><span class="co">#&gt; # cubble:   key: gid [1], index: datetime, nested form, [sf]</span></span>
<span><span class="co">#&gt; # spatial:  [0.76, 0.36, 0.76, 0.36], WGS 84</span></span>
<span><span class="co">#&gt; # temporal: datetime [date], geometry [POLYGON [°]]</span></span>
<span><span class="co">#&gt;   gid    long   lat              geom_sum ts          </span></span>
<span><span class="co">#&gt; * &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;           &lt;POINT [°]&gt; &lt;list&gt;      </span></span>
<span><span class="co">#&gt; 1 d     0.763 0.365 (0.7627982 0.3647986) &lt;sf [5 × 2]&gt;</span></span></code></pre></div>
</div>
</section><section class="level4"><h4 id="post_table-requires-at-least-two-time-values-per-group-for-creation">2. <code>post_table</code> requires at least two time values per group for creation<a class="anchor" aria-label="anchor" href="#post_table-requires-at-least-two-time-values-per-group-for-creation"></a>
</h4>
<p>When converting and <code>sf</code> or <code>post_array</code> object to <code>post_table</code>, a single time value per group is not supported.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">arr</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">datetime</span> <span class="op">==</span> <span class="st">"2020-10-01"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/as_post_table.html">as_post_table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in `as_post_table()`:</span></span>
<span><span class="co">#&gt; ! `x` has only one time value per group</span></span>
<span><span class="co">#&gt; &lt;post_table&gt; creation requires at least two time values</span></span></code></pre></div>
</div>
<p>You can have, however, a <code>post_table</code> with a single time value per group after its creation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">arr</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/as_post_table.html">as_post_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://huizezhang-sherry.github.io/cubble/reference/face.html" class="external-link">face_temporal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">datetime</span> <span class="op">==</span> <span class="st">"2020-10-01"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://huizezhang-sherry.github.io/cubble/reference/face.html" class="external-link">face_spatial</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: st_centroid assumes attributes are constant over geometries</span></span>
<span><span class="co">#&gt; # cubble:   key: gid [5], index: datetime, nested form, [sf]</span></span>
<span><span class="co">#&gt; # spatial:  [-0.42, -0.01, 0.99, 1.17], WGS 84</span></span>
<span><span class="co">#&gt; # temporal: datetime [date], int_circles [lgl], geometry [POLYGON [°]]</span></span>
<span><span class="co">#&gt;   gid      long   lat                                             geom_sum ts   </span></span>
<span><span class="co">#&gt; * &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;                                        &lt;POLYGON [°]&gt; &lt;lis&gt;</span></span>
<span><span class="co">#&gt; 1 a      0.638  0.885 ((0.5137787 1.117004, 0.9005707 0.866971, 0.7627607… &lt;sf&gt; </span></span>
<span><span class="co">#&gt; 2 b     -0.0180 0.768 ((-0.008469583 1.165177, 0.3796448 0.767853, -0.027… &lt;sf&gt; </span></span>
<span><span class="co">#&gt; 3 c      0.402  0.507 ((0.3321185 0.7217665, 0.6273178 0.5211933, 0.47124… &lt;sf&gt; </span></span>
<span><span class="co">#&gt; 4 d      0.744  0.341 ((0.6633875 0.5730321, 0.9881167 0.3122207, 0.82478… &lt;sf&gt; </span></span>
<span><span class="co">#&gt; 5 e      0.467  0.180 ((0.6988282 0.004623805, 0.2489107 -0.01302429, 0.2… &lt;sf&gt;</span></span></code></pre></div>
</div>
</section><section class="level4"><h4 id="do-not-drop-dimensions-when-slicing-post_array-objects">3. Do not drop dimensions when slicing <code>post_array</code> objects<a class="anchor" aria-label="anchor" href="#do-not-drop-dimensions-when-slicing-post_array-objects"></a>
</h4>
<p>The default behavior of <code><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">dplyr::slice()</a></code> for stars and post_table objects is to drop dimensions with a single value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">arr</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="st">"datetime"</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; stars object with 1 dimensions and 2 attributes</span></span>
<span><span class="co">#&gt; attribute(s):</span></span>
<span><span class="co">#&gt;          geometry  int_circles    </span></span>
<span><span class="co">#&gt;  POLYGON      :5   Mode :logical  </span></span>
<span><span class="co">#&gt;  epsg:4326    :0   FALSE:3        </span></span>
<span><span class="co">#&gt;  +proj=long...:0   TRUE :2        </span></span>
<span><span class="co">#&gt; dimension(s):</span></span>
<span><span class="co">#&gt;          from to refsys point</span></span>
<span><span class="co">#&gt; geom_sum    1  5 WGS 84 FALSE</span></span>
<span><span class="co">#&gt;                                                                 values</span></span>
<span><span class="co">#&gt; geom_sum POLYGON ((0.5137787 1.117...,...,POLYGON ((0.6988282 0.004...</span></span></code></pre></div>
</div>
<p>As we saw in <em>2</em>, this brings problems when converting to a <code>post_table</code> but in general it also generates other types of issues. Make a habit of using <code>drop = FALSE</code> instead.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">arr</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="st">"geom_sum"</span>, <span class="fl">1</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/as_post_table.html">as_post_table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: st_centroid assumes attributes are constant over geometries</span></span>
<span><span class="co">#&gt; # cubble:   key: gid [1], index: datetime, nested form, [sf]</span></span>
<span><span class="co">#&gt; # spatial:  [0.38, 0.65, 0.9, 1.12], WGS 84</span></span>
<span><span class="co">#&gt; # temporal: datetime [date], geometry [POLYGON [°]]</span></span>
<span><span class="co">#&gt;   gid   int_circles  long   lat                                   geom_sum ts   </span></span>
<span><span class="co">#&gt; * &lt;chr&gt; &lt;lgl&gt;       &lt;dbl&gt; &lt;dbl&gt;                              &lt;POLYGON [°]&gt; &lt;lis&gt;</span></span>
<span><span class="co">#&gt; 1 a     FALSE       0.638 0.885 ((0.5137787 1.117004, 0.9005707 0.866971,… &lt;sf&gt;</span></span></code></pre></div>
</div>
</section></section></section><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'light-border',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config);
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://loreabad6.github.io" class="external-link">Lorena Abad</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
